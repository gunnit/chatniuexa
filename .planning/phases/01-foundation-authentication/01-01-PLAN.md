---
phase: 01-foundation-authentication
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - tailwind.config.ts
  - next.config.ts
  - .env.local.example
  - src/lib/supabase/client.ts
  - src/lib/supabase/server.ts
  - src/lib/supabase/middleware.ts
  - src/app/layout.tsx
  - src/app/page.tsx
  - src/app/globals.css
autonomous: true
user_setup:
  - service: supabase
    why: "Authentication and database"
    env_vars:
      - name: NEXT_PUBLIC_SUPABASE_URL
        source: "Supabase Dashboard -> Project Settings -> API -> Project URL"
      - name: NEXT_PUBLIC_SUPABASE_ANON_KEY
        source: "Supabase Dashboard -> Project Settings -> API -> anon/public key"
      - name: SUPABASE_SERVICE_ROLE_KEY
        source: "Supabase Dashboard -> Project Settings -> API -> service_role key (keep secret!)"
      - name: NEXT_PUBLIC_SITE_URL
        source: "Set to http://localhost:3000 for development"
    dashboard_config:
      - task: "Create new Supabase project"
        location: "https://supabase.com/dashboard -> New Project"

must_haves:
  truths:
    - "Next.js 15 project runs with npm run dev"
    - "Supabase browser client can be imported"
    - "Supabase server client can be imported"
    - "Middleware helper function exists for session refresh"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies"
      contains: "@supabase/ssr"
    - path: "src/lib/supabase/client.ts"
      provides: "Browser client factory"
      exports: ["createClient"]
    - path: "src/lib/supabase/server.ts"
      provides: "Server client factory"
      exports: ["createClient"]
    - path: "src/lib/supabase/middleware.ts"
      provides: "Session refresh helper"
      exports: ["updateSession"]
  key_links:
    - from: "src/lib/supabase/client.ts"
      to: "@supabase/ssr"
      via: "createBrowserClient"
      pattern: "createBrowserClient"
    - from: "src/lib/supabase/server.ts"
      to: "@supabase/ssr"
      via: "createServerClient"
      pattern: "createServerClient"
---

<objective>
Initialize Next.js 15 project and create Supabase client utilities for authentication.

Purpose: Establish the project foundation with proper TypeScript configuration and Supabase integration patterns that all subsequent plans will build upon.
Output: Working Next.js project with Supabase client files ready for authentication implementation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-authentication/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Next.js 15 project with dependencies</name>
  <files>
    package.json
    tsconfig.json
    tailwind.config.ts
    next.config.ts
    .env.local.example
    src/app/layout.tsx
    src/app/page.tsx
    src/app/globals.css
  </files>
  <action>
    Initialize Next.js 15 project using create-next-app with these options:
    - TypeScript: yes
    - ESLint: yes
    - Tailwind CSS: yes
    - src/ directory: yes
    - App Router: yes
    - Turbopack: yes (default for dev)
    - Import alias: @/* (default)

    Run: `npx create-next-app@latest . --typescript --eslint --tailwind --src-dir --app --turbopack --import-alias "@/*" --use-npm`

    Note: Use --use-npm since package-lock.json is preferred over yarn.lock for this project.

    After project creation, install Supabase packages:
    `npm install @supabase/supabase-js @supabase/ssr zod`

    Create `.env.local.example` with placeholder values:
    ```
    NEXT_PUBLIC_SUPABASE_URL=your_project_url
    NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
    SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
    NEXT_PUBLIC_SITE_URL=http://localhost:3000
    ```

    Update the default src/app/page.tsx to show a simple landing page:
    - Title: "niuexa.ai"
    - Subtitle: "AI chatbots trained on your data"
    - Links to /login and /signup (these will be created in later plans)
  </action>
  <verify>
    - `npm run dev` starts server without errors
    - Navigate to http://localhost:3000 shows landing page
    - `npm list @supabase/ssr @supabase/supabase-js zod` shows packages installed
  </verify>
  <done>
    Next.js 15 project runs, Tailwind works, Supabase packages installed, env example file exists
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Supabase client utilities</name>
  <files>
    src/lib/supabase/client.ts
    src/lib/supabase/server.ts
    src/lib/supabase/middleware.ts
  </files>
  <action>
    Create three Supabase client files following the official @supabase/ssr patterns from the research:

    1. `src/lib/supabase/client.ts` - Browser client:
       - Export `createClient` function that returns `createBrowserClient` from @supabase/ssr
       - Uses NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY
       - This is for client-side usage in Client Components

    2. `src/lib/supabase/server.ts` - Server client:
       - Export async `createClient` function that returns `createServerClient` from @supabase/ssr
       - Uses cookies() from next/headers
       - Implements getAll() and setAll() cookie handlers
       - The setAll try/catch pattern handles Server Components (cookies are read-only there)
       - CRITICAL: This client is for Server Components, Server Actions, and Route Handlers

    3. `src/lib/supabase/middleware.ts` - Session refresh helper:
       - Export async `updateSession` function accepting NextRequest
       - Creates server client with request/response cookie handling
       - CRITICAL: Call `await supabase.auth.getUser()` (NOT getSession!) to validate JWT
       - Returns the response with refreshed cookies

    Use exact patterns from 01-RESEARCH.md "Pattern 1: Cookie-Based Session with Middleware Refresh"
  </action>
  <verify>
    - All three files exist with correct exports
    - TypeScript compiles without errors: `npx tsc --noEmit`
    - Imports resolve correctly (no module not found errors)
  </verify>
  <done>
    Three Supabase client files exist with proper typing, following official @supabase/ssr patterns
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` starts without errors
2. `npm run build` compiles successfully
3. All Supabase client files have correct exports
4. TypeScript has no errors
5. Landing page renders at http://localhost:3000
</verification>

<success_criteria>
- Next.js 15 project initialized with App Router
- Supabase packages (@supabase/supabase-js, @supabase/ssr, zod) installed
- Three Supabase client utilities created following official patterns
- Environment variable example file exists
- Project builds and runs without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-authentication/01-01-SUMMARY.md`
</output>
